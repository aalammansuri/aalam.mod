<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ìÜ© ‚Ñ¢·≠Ñùóü·¥è Ä·¥Ö ùòü ùóî·¥Ä ü·¥Ä·¥ç‡øê</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Orbitron:wght@500&display=swap"
  rel="stylesheet"
/>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<style>
  body {
    background-color: #0b1120;
    color: #e0ffff;
    font-family: 'Poppins', sans-serif;
    position: relative;
    overflow-x: hidden;
  }
  
  #particles-js {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 0;
    background-color: #0b1120;
  }
  
  .content-wrapper {
    position: relative;
    z-index: 1;
  }
  
  .login-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  
  .login-box {
    width: 100%;
    max-width: 400px;
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 0 20px rgba(167, 139, 250, 0.3);
  }
  
  @keyframes rgb-danger {
    0% {
      text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000;
      color: #ff0000;
    }
    16% {
      text-shadow: 0 0 5px #ff5e00, 0 0 10px #ff5e00;
      color: #ff5e00;
    }
    32% {
      text-shadow: 0 0 5px #ffbb00, 0 0 10px #ffbb00;
      color: #ffbb00;
    }
    48% {
      text-shadow: 0 0 5px #00ff22, 0 0 10px #00ff22;
      color: #00ff22;
    }
    64% {
      text-shadow: 0 0 5px #00a2ff, 0 0 10px #00a2ff;
      color: #00a2ff;
    }
    80% {
      text-shadow: 0 0 5px #a200ff, 0 0 10px #a200ff;
      color: #a200ff;
    }
    100% {
      text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000;
      color: #ff0000;
    }
  }
  
  .danger-text {
    animation: rgb-danger 1.5s linear infinite;
    font-weight: 900;
    letter-spacing: 1px;
  }
  
  .wrapper svg {
    width: 100%;
    height: 70px;
    margin-bottom: 10px;
  }
  
  .wrapper svg text {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    stroke-width: 1.5px;
    letter-spacing: 2px;
    animation: rgb-danger 2s linear infinite;
  }
  
  .hidden {
    display: none;
  }
</style>
</head>
<body class="bg-gray-900 text-gray-200 font-poppins min-h-screen p-4">
  <div id="particles-js"></div>
  
  <!-- Login Section -->
  <div id="loginSection" class="login-wrapper">
    <div class="login-box">
      <div class="wrapper mb-8">
        <svg>
          <text x="50%" y="50%" dy=".35em" text-anchor="middle" class="danger-text">
            ìÜ© ‚Ñ¢·≠Ñùóü·¥è Ä·¥Ö ùòü ùóî·¥Ä ü·¥Ä·¥ç‡øê 
          </text>
        </svg>
      </div>
      
      <div class="mb-6">
        <label for="accessKey" class="block text-gray-300 mb-2">Enter Access Key:</label>
        <input 
          type="password" 
          id="accessKey" 
          class="w-full px-4 py-3 bg-gray-800 border border-purple-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600 text-white"
          placeholder="Your secret key"
        >
      </div>
      
      <button 
        onclick="checkAccessKey()"
        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300"
      >
        <i class="fas fa-lock-open mr-2"></i> Unlock System
      </button>
      
      <div id="accessMessage" class="mt-4 text-center text-red-500 hidden">
        <i class="fas fa-exclamation-circle mr-2"></i> Invalid access key or system is currently closed
      </div>
      
      <div id="nextOpening" class="mt-6 text-center text-gray-400 text-sm">
        Next opening time: <span id="nextOpenTime" class="font-bold">-</span>
      </div>
    </div>
  </div>
  
  <!-- Main Content (Hidden until login) -->
  <div id="mainContent" class="content-wrapper container max-w-md mx-auto space-y-6 hidden">
    <div class="wrapper">
      <svg>
        <text x="50%" y="50%" dy=".35em" text-anchor="middle" class="danger-text">
          ìÜ© ‚Ñ¢·≠Ñùóü·¥è Ä·¥Ö ùòü ùóî·¥Ä ü·¥Ä·¥ç‡øê 
        </text>
      </svg>
    </div>

    <div class="bg-gray-800/70 rounded-xl p-6 shadow-lg border border-purple-500/30">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-semibold danger-text glow flex items-center">
          <i class="fa-solid fa-brain mr-2"></i> Current Prediction :-
        </h2>
      </div>
      <div class="bg-gray-700/50 rounded-lg p-4 text-center border border-purple-500/30">
        <div class="text-gray-300 mb-3 danger-text">
          PERIOD: <span id="currentPeriodDisplay" class="font-bold">-</span>
        </div>
        <div
          id="currentPredictionDisplay"
          class="text-4xl font-bold danger-text glow mb-2"
        >
          -
        </div>
        <div class="text-gray-200 danger-text">
          WIN RATE: <span id="currentWinRateDisplay" class="font-bold">0%</span>
        </div>
      </div>
    </div>

    <div class="bg-gray-800/70 rounded-xl p-6 shadow-lg border border-purple-500/30">
      <h2 class="text-2xl font-semibold danger-text glow mb-4">
        <i class="fas fa-chart-line mr-2"></i> Analysis Dashboard
      </h2>
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-gray-700/50 rounded-lg p-4 text-center border border-green-500/30 hover:border-green-500/70 transition-all">
          <div class="text-gray-400"><i class="fas fa-trophy mr-1"></i> Wins</div>
          <div id="wins" class="text-2xl font-bold danger-text glow">0</div>
        </div>
        <div class="bg-gray-700/50 rounded-lg p-4 text-center border border-red-500/30 hover:border-red-500/70 transition-all">
          <div class="text-gray-300"><i class="fas fa-times-circle mr-1"></i> Losses</div>
          <div id="losses" class="text-2xl font-bold danger-text glow">0</div>
        </div>
        <div class="bg-gray-700/50 rounded-lg p-4 text-center border border-blue-500/30 hover:border-blue-500/70 transition-all">
          <div class="text-gray-300"><i class="fas fa-percentage mr-1"></i> Win Rate</div>
          <div id="accuracy" class="text-2xl font-bold danger-text glow">0%</div>
        </div>
        <div class="bg-gray-700/50 rounded-lg p-4 text-center border border-yellow-500/30 hover:border-yellow-500/70 transition-all">
          <div class="text-gray-300"><i class="fas fa-server mr-1"></i> Server Status</div>
          <div class="text-2xl font-bold text-green-500 glow">Connected <i class="fas fa-plug ml-1"></i></div>
        </div>
      </div>
    </div>

    <button
      onclick="fetchRecentHistory()"
      class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 rounded-lg transition-all duration-300 shadow-lg mb-4"
    >
      <i class="fas fa-history mr-2"></i> Show Raw Recent Game History (API)
    </button>

    <div
      class="bg-gray-800/70 rounded-xl p-6 shadow-lg overflow-y-auto max-h-80 border border-purple-500/30"
      id="historyWrapper"
    >
      <h2 class="text-2xl font-semibold danger-text glow mb-4">
        <i class="fas fa-clock-rotate-left mr-2"></i> Game History
      </h2>
      <div id="historyContainer" class="space-y-4"></div>
      <button
        onclick="clearHistory()"
        class="w-full bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white font-semibold py-3 rounded-lg transition-all duration-300 shadow-lg mt-4"
      >
        <i class="fas fa-trash-alt mr-2"></i> Clear All History
      </button>
    </div>
  </div>

  <script>
    // Initialize particles.js
    document.addEventListener('DOMContentLoaded', function() {
      particlesJS('particles-js', {
        "particles": {
          "number": {
            "value": 120,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff", "#00ffff"]
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            },
            "polygon": {
              "nb_sides": 5
            }
          },
          "opacity": {
            "value": 0.7,
            "random": true,
            "anim": {
              "enable": true,
              "speed": 1,
              "opacity_min": 0.3,
              "sync": false
            }
          },
          "size": {
            "value": 4,
            "random": true,
            "anim": {
              "enable": true,
              "speed": 3,
              "size_min": 1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 120,
            "color": "#ffffff",
            "opacity": 0.4,
            "width": 1.5
          },
          "move": {
            "enable": true,
            "speed": 2,
            "direction": "none",
            "random": true,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": true,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "window",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 150,
              "line_linked": {
                "opacity": 1
              }
            },
            "bubble": {
              "distance": 400,
              "size": 40,
              "duration": 2,
              "opacity": 8,
              "speed": 3
            },
            "repulse": {
              "distance": 200,
              "duration": 0.4
            },
            "push": {
              "particles_nb": 6
            },
            "remove": {
              "particles_nb": 2
            }
          }
        },
        "retina_detect": true
      });
      
      // Initialize access time checker
      checkAccessTimes();
      setInterval(checkAccessTimes, 60000); // Check every minute
      updateNextOpeningTime();
    });

    // Configuration
    const ACCESS_KEY = "LordXAlam123"; // Change this to your desired key
    const OPEN_TIMES = [
      { hour: 9, minute: 30 },  // 9:30 AM
      { hour: 12, minute: 0 },  // 12:00 PM
      { hour: 14, minute: 0 }   // 2:00 PM
    ];
    const OPEN_DURATION = 10; // 10 minutes
    
    let isSystemOpen = false;
    let currentSessionTimeout = null;
    let historyData = [];
    let lastFetchedPeriod = null;
    let lastPrediction = null;
    let lastOppositeNumber = null;
    let streak = 0;

    function checkAccessTimes() {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();
      
      // Check if current time matches any opening time
      for (const time of OPEN_TIMES) {
        if (currentHour === time.hour && 
            currentMinute >= time.minute && 
            currentMinute < time.minute + OPEN_DURATION) {
          if (!isSystemOpen) {
            openSystem();
          }
          return;
        }
      }
      
      // If we're here, we're not in an open window
      if (isSystemOpen) {
        closeSystem();
      }
    }
    
    function openSystem() {
      isSystemOpen = true;
      document.getElementById('accessMessage').classList.add('hidden');
      
      // Set timeout to automatically close after OPEN_DURATION minutes
      if (currentSessionTimeout) {
        clearTimeout(currentSessionTimeout);
      }
      currentSessionTimeout = setTimeout(() => {
        closeSystem();
        if (document.getElementById('mainContent').classList.contains('hidden') === false) {
          alert("Session expired! System is now closed.");
          document.getElementById('loginSection').classList.remove('hidden');
          document.getElementById('mainContent').classList.add('hidden');
        }
      }, OPEN_DURATION * 60 * 1000);
    }
    
    function closeSystem() {
      isSystemOpen = false;
      if (currentSessionTimeout) {
        clearTimeout(currentSessionTimeout);
        currentSessionTimeout = null;
      }
    }
    
    function updateNextOpeningTime() {
      const now = new Date();
      let nextTime = null;
      
      // Find the next opening time today
      for (const time of OPEN_TIMES) {
        const openingTime = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
          time.hour,
          time.minute
        );
        
        if (openingTime > now) {
          nextTime = openingTime;
          break;
        }
      }
      
      // If no more times today, use first time tomorrow
      if (!nextTime) {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        nextTime = new Date(
          tomorrow.getFullYear(),
          tomorrow.getMonth(),
          tomorrow.getDate(),
          OPEN_TIMES[0].hour,
          OPEN_TIMES[0].minute
        );
      }
      
      document.getElementById('nextOpenTime').textContent = 
        nextTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    function checkAccessKey() {
      const enteredKey = document.getElementById('accessKey').value;
      const accessMessage = document.getElementById('accessMessage');
      
      if (enteredKey === ACCESS_KEY && isSystemOpen) {
        // Correct key and system is open
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('mainContent').classList.remove('hidden');
        accessMessage.classList.add('hidden');
        updatePrediction(); // Start the prediction system
      } else {
        // Either wrong key or system is closed
        accessMessage.classList.remove('hidden');
        if (!isSystemOpen) {
          accessMessage.innerHTML = '<i class="fas fa-clock mr-2"></i> System is currently closed. Please try again during opening hours.';
        } else {
          accessMessage.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i> Invalid access key!';
        }
      }
    }

    // Predict BIG or SMALL based on recent history
    function ultraAIPredict(history) {
      if (history.length < 3) {
        return { prediction: Math.random() >= 0.5 ? 'BIG' : 'SMALL' };
      }
      let bigCount = 0;
      let smallCount = 0;
      let weight = 1;

      // Check last 8 results or fewer if less history
      for (let i = 0; i < Math.min(history.length, 8); i++) {
        let entry = history[i];
        if (entry.result === '-') continue; // Skip pending

        let num = Number(entry.result);
        if (num >= 5) {
          bigCount += weight;
        } else {
          smallCount += weight;
        }
        weight *= 1.8;
      }
      return { prediction: bigCount >= smallCount ? 'BIG' : 'SMALL' };
    }

    function getOppositeNumber(prediction) {
      const small = [5, 6, 7, 8, 9];
      const big = [0, 1, 2, 3, 4];
      return prediction === 'BIG'
        ? small[Math.floor(Math.random() * small.length)]
        : big[Math.floor(Math.random() * big.length)];
    }

    // Update last game result status (WIN/LOSS/PENDING)
    function updateLastStatus(actualNumber) {
      if (historyData.length === 0) return;

      const lastEntry = historyData[0];
      if (lastEntry.resultStatus !== 'Pending') return; // Already processed

      const lastPred = lastEntry.prediction;
      const wasWin = (actualNumber >= 5 && lastPred === 'BIG') || (actualNumber < 5 && lastPred === 'SMALL');

      lastEntry.result = actualNumber.toString();
      lastEntry.resultStatus = wasWin ? 'WIN' : 'LOSS';
      lastEntry.calculation = `Number ${actualNumber} (${actualNumber >= 5 ? 'BIG' : 'SMALL'})`;

      streak = wasWin ? streak + 1 : 0;
    }

    async function fetchGameResult() {
      try {
        const response = await fetch(
          'https://api.bdg88zf.com/api/webapi/GetNoaverageEmerdList',
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              pageSize: 10,
              pageNo: 1,
              typeId: 1,
              language: 0,
              random: '4a0522c6ecd8410496260e686be2a57c',
              signature: '334B5E70A0C9B8918B0B15E517E2069C',
              timestamp: Math.floor(Date.now() / 1000),
            }),
          }
        );
        const data = await response.json();
        return data?.data?.list?.[0] || null;
      } catch (e) {
        console.error('API error:', e);
        return null;
      }
    }

    async function updatePrediction() {
      const result = await fetchGameResult();
      if (!result) return;

      // Skip duplicate period
      if (result.issueNumber === lastFetchedPeriod) return;

      // Update last result status if pending
      if (historyData.length > 0 && historyData[0].resultStatus === 'Pending') {
        updateLastStatus(Number(result.number));
      }

      // AI Prediction for next period
      const predictionObj = ultraAIPredict(historyData);
      lastPrediction = predictionObj.prediction;
      lastOppositeNumber = getOppositeNumber(lastPrediction);

      // Calculate next period (increment issue number)
      const nextPeriodFull = (BigInt(result.issueNumber) + 1n).toString();

      // Randomized win chance for display only
      const winChance = Math.floor(Math.random() * (100 - 50 + 1)) + 50;

      // Update UI
      document.getElementById('currentPeriodDisplay').innerText = nextPeriodFull;
      document.getElementById('currentPredictionDisplay').innerText = lastPrediction;
      document.getElementById('currentWinRateDisplay').innerText = `${winChance}%`;

      // Add new prediction entry with pending status
      historyData.unshift({
        period: nextPeriodFull.slice(-3),
        prediction: lastPrediction,
        oppositeNumber: lastOppositeNumber,
        result: '-',
        resultStatus: 'Pending',
        calculation: '-',
      });

      updateHistory();
      updateStats();

      lastFetchedPeriod = result.issueNumber;
    }

    function updateHistory() {
      const container = document.getElementById('historyContainer');
      container.innerHTML = historyData
        .map((item) => {
          let borderClass =
            item.resultStatus === 'WIN'
              ? 'border-l-4 border-green-500'
              : item.resultStatus === 'LOSS'
              ? 'border-l-4 border-red-500'
              : 'border-l-4 border-yellow-500';
          let iconClass =
            item.resultStatus === 'WIN'
              ? 'fa-check-circle text-green-500'
              : item.resultStatus === 'LOSS'
              ? 'fa-xmark-circle text-red-500'
              : 'fa-spinner spinner text-yellow-500';

          return `
            <div class="bg-gray-700/50 rounded-lg p-4 ${borderClass} hover:bg-gray-700/70 transition-all">
              <div class="flex justify-between items-center">
                <div>
                  <div class="text-gray-200 font-semibold"><i class="far fa-calendar-alt mr-1"></i> Period: ${item.period}</div>
                  <div class="text-gray-200"><i class="fas fa-magic mr-1"></i> Prediction: <span class="font-bold">${item.prediction}</span></div>
                  <div class="text-gray-200"><i class="fas fa-dice mr-1"></i> Number: ${item.oppositeNumber}</div>
                  <div class="text-gray-200"><i class="fas fa-calculator mr-1"></i> Calculation: ${item.calculation}</div>
                </div>
                <i class="fa-solid ${iconClass} fa-lg"></i>
              </div>
            </div>
          `;
        })
        .join('');
    }

    function updateStats() {
      let wins = historyData.filter((h) => h.resultStatus === 'WIN').length;
      let losses = historyData.filter((h) => h.resultStatus === 'LOSS').length;
      let total = wins + losses;
      let accuracy = total === 0 ? 0 : Math.round((wins / total) * 100);

      document.getElementById('wins').innerText = wins;
      document.getElementById('losses').innerText = losses;
      document.getElementById('accuracy').innerText = accuracy + '%';
    }

    function clearHistory() {
      historyData = [];
      updateHistory();
      updateStats();
      document.getElementById('currentPeriodDisplay').innerText = '-';
      document.getElementById('currentPredictionDisplay').innerText = '-';
      document.getElementById('currentWinRateDisplay').innerText = '0%';
      lastFetchedPeriod = null;
    }

    async function fetchRecentHistory() {
      try {
        const response = await fetch(
          'https://api.bdg88zf.com/api/webapi/GetNoaverageEmerdList',
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              pageSize: 10,
              pageNo: 1,
              typeId: 1,
              language: 0,
              random: '4a0522c6ecd8410496260e686be2a57c',
              signature: '334B5E70A0C9B8918B0B15E517E2069C',
              timestamp: Math.floor(Date.now() / 1000),
            }),
          }
        );
        const data = await response.json();
        if (!data?.data?.list) {
          alert('No data returned from API');
          return;
        }
        let rawHistoryContainer = document.getElementById('historyContainer');
        let rawListHtml = data.data.list
          .map(
            (item) =>
              `<div class="bg-gray-600/50 rounded-md p-3 mb-3 border border-purple-500/30 hover:border-purple-500/70 transition-all">
                <div><i class="far fa-calendar mr-1"></i> <strong>Period:</strong> ${item.issueNumber}</div>
                <div><i class="fas fa-hashtag mr-1"></i> <strong>Number:</strong> ${item.number}</div>
                <div><i class="far fa-clock mr-1"></i> <strong>Time:</strong> ${item.openTime}</div>
              </div>`
          )
          .join('');
        rawHistoryContainer.innerHTML = rawListHtml;
      } catch (error) {
        alert('Failed to fetch recent history');
        console.error(error);
      }
    }

    // Auto refresh prediction every 20 seconds (only when logged in)
    setInterval(() => {
      if (!document.getElementById('mainContent').classList.contains('hidden')) {
        updatePrediction();
      }
    }, 20000);
  </script>
</body>
</html>